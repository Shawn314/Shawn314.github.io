<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-11-20 Wed 20:10 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>阮一峰Makefile学习指南总结</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="方潇" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">阮一峰Makefile学习指南总结</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org10079a3">1. Makefile文件格式</a>
<ul>
<li><a href="#org9e80542">1.1. 概述</a></li>
<li><a href="#org61ec430">1.2. 目标</a></li>
<li><a href="#org90f21b3">1.3. 前置条件</a></li>
<li><a href="#orge7060f2">1.4. 命令</a></li>
</ul>
</li>
<li><a href="#orgabf53d0">2. Makefile文件的语法</a>
<ul>
<li><a href="#org835a465">2.1. 注释</a></li>
<li><a href="#org936b554">2.2. 回声</a></li>
<li><a href="#org4962855">2.3. 通配符</a></li>
<li><a href="#orgd3192e4">2.4. 模式匹配</a></li>
<li><a href="#org33a8486">2.5. 变量和赋值符</a></li>
<li><a href="#org9e56eea">2.6. 内置变量</a></li>
<li><a href="#org74aea8e">2.7. 自动变量</a></li>
<li><a href="#org183249a">2.8. 判断和循环</a></li>
<li><a href="#orgcdb3910">2.9. 函数</a></li>
</ul>
</li>
<li><a href="#org3e6646c">3. Makefile的实例</a></li>
</ul>
</div>
</div>
<div id="outline-container-org10079a3" class="outline-2">
<h2 id="org10079a3"><span class="section-number-2">1</span> Makefile文件格式</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org9e80542" class="outline-3">
<h3 id="org9e80542"><span class="section-number-3">1.1</span> 概述</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Makefile由一系列规则组成，每条规则的形式如下。
</p>
<div class="org-src-container">
<pre class="src src-shell">&lt;target&gt; : &lt;prerequisite&gt;
[tab] &lt;command&gt;
</pre>
</div>
<p>
*目标*是必须的，不可省略。*命令*和*前置命令*是可选的，但是两者必有其一。每条规则就明确两件事：<sub>构建目标的前置条件是什么</sub>，以及如何构建_。下面就详细讲解，每条规则的这三个组成部分。
</p>
</div>
</div>
<div id="outline-container-org61ec430" class="outline-3">
<h3 id="org61ec430"><span class="section-number-3">1.2</span> 目标</h3>
<div class="outline-text-3" id="text-1-2">
<p>
一个目标就构成一条规则。可以是文件名，也可以是多个文件名。除了文件名，目标还可以是某个操作的名字，这称为“伪目标”（phony target）
</p>
<div class="org-src-container">
<pre class="src src-shell">clean:
      rm *.o
</pre>
</div>
<p>
上述代码的目标是clean，它不是文件名，而是一个操作的名字，作用删除对象文件。但当前目录存在clean这个文件，它就不会执行了，因为文件已经存在。为了这种情况，可以明确声明clean是“伪目标”，写法如下。
</p>
<div class="org-src-container">
<pre class="src src-shell">.PHONY: clean
clean:
     rm *.o
</pre>
</div>
<p>
像PHONY这种内置的目标明还有不少，可以查看<a href="https://www.gnu.org/software/make/manual/html_node/Special-Targets.html#Special-Targets">手册</a>。如果没有指定目标的话，默认执行第一个目标
</p>
<div class="org-src-container">
<pre class="src src-shell">$ make
</pre>
</div>
</div>
</div>
<div id="outline-container-org90f21b3" class="outline-3">
<h3 id="org90f21b3"><span class="section-number-3">1.3</span> 前置条件</h3>
<div class="outline-text-3" id="text-1-3">
<p>
前置条件通常是一组文件名，之前用空格隔开，它指定了“目标”是否需要重新构建的判断标准，只要有一个前置文件不存在，或者更新过，“目标”就需要重新构建。
</p>
<div class="org-src-container">
<pre class="src src-shell">result.txt: source.txt
    cp source.txt result.txt
</pre>
</div>
<p>
必须存在 source.txt才能正常make，否则必须生成source。
</p>
<div class="org-src-container">
<pre class="src src-shell">source.txt:
    <span style="color: #9fbfdf;">echo</span> <span style="color: #ddbc91;">"this is the source"</span> &gt; source.txt
</pre>
</div>
<p>
上面代码中，source.txt后面没有前置条件，就意味着它跟其他文件都无关，只要这个文件还不存在，每次调用make source.txt，它都会生成。如果需要生成多个文件，往往采用下面的写法。
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #9fbfdf;">source</span>: file1 file2 file3
</pre>
</div>
<p>
执行make source命令后，就会一次性生成 file1，file2，file3 三个文件。
</p>
<div class="org-src-container">
<pre class="src src-shell">$ make source
</pre>
</div>
</div>
</div>
<div id="outline-container-orge7060f2" class="outline-3">
<h3 id="orge7060f2"><span class="section-number-3">1.4</span> 命令</h3>
<div class="outline-text-3" id="text-1-4">
<p>
命令（conmmand）表示如何更新目标文件，由一行或者多行的shell命令组成。它是构建“目标”的具体命令。每行命令前必须有一个*tab*键，如果想换成其他键可以使用内置变量 <b>.RECIPEPREFIX</b> 声明。
</p>
<div class="org-src-container">
<pre class="src src-shell">.RECIPEPREFIX = &gt;
all:
&gt; echo Hello, world
</pre>
</div>
<p>
需要注意的是，*每行命令*在一个单独的shell中执行。这些 <span class="underline">Shell之间没有继承关系</span> 。
</p>
<div class="org-src-container">
<pre class="src src-shell">var-lost:
    <span style="color: #9fbfdf;">export</span> <span style="color: #aaca86;">foo</span>=bar
    <span style="color: #9fbfdf;">echo</span> <span style="color: #ddbc91;">"foo=[$$foo]"</span>
</pre>
</div>
<p>
上面代码执行后（make var-lost），取不到foo的值。因为两行命令在两个不同的进程执行。一个解决办法是将两行命令写在一行，中间用分号分隔。
</p>
<div class="org-src-container">
<pre class="src src-shell">var-kept:
    <span style="color: #9fbfdf;">export</span> <span style="color: #aaca86;">foo</span>=bar; <span style="color: #9fbfdf;">echo</span> <span style="color: #ddbc91;">"foo=[$$foo]"</span>
</pre>
</div>
<p>
另一个解决办法是在换行符前加反斜杠转义。
</p>
<div class="org-src-container">
<pre class="src src-shell">var-kept:
    <span style="color: #9fbfdf;">export</span> <span style="color: #aaca86;">foo</span>=bar; <span style="color: #ddbc91;">\</span>
    <span style="color: #9fbfdf;">echo</span> <span style="color: #ddbc91;">"foo=[$$foo]"</span>
</pre>
</div>
<p>
最后一个办法就是加上*.ONESHELL:*命令。
</p>
<div class="org-src-container">
<pre class="src src-shell">.ONESHELL:
var-kept:
    <span style="color: #9fbfdf;">export</span> <span style="color: #aaca86;">foo</span>=bar;
    <span style="color: #9fbfdf;">echo</span> <span style="color: #ddbc91;">"foo=[$$foo]"</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgabf53d0" class="outline-2">
<h2 id="orgabf53d0"><span class="section-number-2">2</span> Makefile文件的语法</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org835a465" class="outline-3">
<h3 id="org835a465"><span class="section-number-3">2.1</span> 注释</h3>
<div class="outline-text-3" id="text-2-1">
<p>
注释使用*#*。
</p>
</div>
</div>
<div id="outline-container-org936b554" class="outline-3">
<h3 id="org936b554"><span class="section-number-3">2.2</span> 回声</h3>
<div class="outline-text-3" id="text-2-2">
<p>
正常情况下，make会打印每条命令，然后再执行，这就叫做回声（echoing）。在命令的前面加上@，就可以关闭回声。由于在构建过程中，需要了解当前在执行哪条命令，所以通常只在注释和纯显示的echo命令前面加上@。
</p>
</div>
</div>
<div id="outline-container-org4962855" class="outline-3">
<h3 id="org4962855"><span class="section-number-3">2.3</span> 通配符</h3>
</div>
<div id="outline-container-orgd3192e4" class="outline-3">
<h3 id="orgd3192e4"><span class="section-number-3">2.4</span> 模式匹配</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Make命令允许对文件名，进行类似正则运算的匹配，主要用到的匹配符是%。比如，假定当前目录下有 f1.c 和 f2.c 两个源码文件，需要将它们编译为对应的对象文件。
</p>
<div class="org-src-container">
<pre class="src src-shell">%.o: %.c
</pre>
</div>
<p>
等同于
</p>
<div class="org-src-container">
<pre class="src src-shell">f1.o: f1.c
f2.o: f2.c
</pre>
</div>
</div>
</div>
<div id="outline-container-org33a8486" class="outline-3">
<h3 id="org33a8486"><span class="section-number-3">2.5</span> 变量和赋值符</h3>
<div class="outline-text-3" id="text-2-5">
<p>
Makefile允许使用等号自定义变量。
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #aaca86;">txt</span> = Hello World
test:
    @echo $(txt)
</pre>
</div>
<p>
调用时，变量需要放在 $( ) 之中调用Shell变量，需要在美元符号前，再加一个美元符号，这是因为Make命令会对美元符号转义。
</p>
<div class="org-src-container">
<pre class="src src-shell">test:
    @echo $<span style="color: #aaca86;">$HOME</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #9fbfdf;">echo</span> $<span style="color: #aaca86;">HOME</span>
</pre>
</div>
<p>
有时，变量的值可能指向另一个变量。
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #aaca86;">v1</span> = $(v2)
</pre>
</div>
<p>
上面代码中，变量 v1 的值是另一个变量 v2。这时会产生一个问题，v1 的值到底在定义时扩展（静态扩展），还是在运行时扩展（动态扩展）？如果 v2 的值是动态的，这两种扩展方式的结果可能会差异很大。为了解决类似问题，Makefile一共提供了四个赋值运算符 （=、:=、？=、+=）,它们的区别请看<a href="http://stackoverflow.com/questions/448910/makefile-variable-assignment">stackoverflow</a>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #aaca86;">variable</span> = value
<span style="color: #706565;"># </span><span style="color: #857575;">&#22312;&#25191;&#34892;&#26102;&#25193;&#23637;&#65292;&#20801;&#35768;&#36882;&#24402;&#25193;&#23637;&#12290;</span>

variable := value
<span style="color: #706565;"># </span><span style="color: #857575;">&#22312;&#23450;&#20041;&#26102;&#25193;&#23637;&#12290;</span>

variable ?= value
<span style="color: #706565;"># </span><span style="color: #857575;">&#21482;&#26377;&#22312;&#35813;&#21464;&#37327;&#20026;&#31354;&#26102;&#25165;&#35774;&#32622;&#20540;&#12290;</span>

<span style="color: #aaca86;">variable</span> += value
<span style="color: #706565;"># </span><span style="color: #857575;">&#23558;&#20540;&#36861;&#21152;&#21040;&#21464;&#37327;&#30340;&#23614;&#31471;&#12290;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org9e56eea" class="outline-3">
<h3 id="org9e56eea"><span class="section-number-3">2.6</span> 内置变量</h3>
<div class="outline-text-3" id="text-2-6">
<p>
make命令提供了一系列的内置变量，比如，\((cc)指向当前使用的编译器，\)(make) 指向当前使用的make工具。详细内置变量查看清单，见<a href="https://www.gnu.org/software/make/manual/html_node/Implicit-Variables.html">手册</a>
</p>
<div class="org-src-container">
<pre class="src src-shell">output:
    $(CC) -o output input.c
</pre>
</div>
</div>
</div>
<div id="outline-container-org74aea8e" class="outline-3">
<h3 id="org74aea8e"><span class="section-number-3">2.7</span> 自动变量</h3>
<div class="outline-text-3" id="text-2-7">
<p>
Make命令还提供一些自动变量，它们的值与当前规则有关。主要有以下几个。
</p>
<dl class="org-dl">
<dt>$@</dt><dd>$@指代当前目标，就是Make命令当前构建的那个目标。比如，make foo的 $@ 就指代foo。</dd>
</dl>
<div class="org-src-container">
<pre class="src src-shell">a.txt b.txt:
    touch $<span style="color: #aaca86;">@</span>
</pre>
</div>
<p>
等同于下面的写法：
</p>
<div class="org-src-container">
<pre class="src src-shell">a.txt:
    touch a.txt
b.txt:
    touch b.txt
</pre>
</div>
<dl class="org-dl">
<dt>$&lt;</dt><dd>$&lt; 指代第一个前置条件。比如，规则为 t: p1 p2，那么$&lt; 就指代p1。</dd>
</dl>
<div class="org-src-container">
<pre class="src src-shell">a.txt: b.txt c.txt
    cp $&lt; $<span style="color: #aaca86;">@</span>
</pre>
</div>
<p>
等同于下面的写法：
</p>
<div class="org-src-container">
<pre class="src src-shell">a.txt: b.txt c.txt
    cp b.txt a.txt
</pre>
</div>
<dl class="org-dl">
<dt>$?</dt><dd>指代比目标更新的所有前置条件，之间用空格分隔。比如，规则为 t: p1 p2，其中 p2 的时间戳比 t 新，$?就指代p2。</dd>
<dt>$^</dt><dd>$^ 指代所有前置条件，之间以空格分隔。比如，规则为 t: p1 p2，那么 $^ 就指代 p1 p2 。</dd>
<dt>$*</dt><dd>$* 指代匹配符 % 匹配的部分， 比如% 匹配 f1.txt 中的f1 ，$* 就表示 f1。</dd>
<dt>$(@D) 和 $(@F)</dt><dd>$(@D) 和 $(@F) 分别指向 $@ 的目录名和文件名。比如，\(@是 src/input.c，那么\)(@D) 的值为 src ，$(@F) 的值为 input.c</dd>
<dt>$(&lt;D) 和 $(&lt;F)</dt><dd>$(&lt;D) 和 $(&lt;F) 分别指向 $&lt; 的目录名和文件名。</dd>
</dl>

<p>
所有的自动变量清单，请看<a href="https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html">手册</a>，下面是一个列子：
</p>
<div class="org-src-container">
<pre class="src src-shell">dest/%.txt: src/%.txt
    @[ -d dest ] || mkdir dest
    cp $&lt; $<span style="color: #aaca86;">@</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org183249a" class="outline-3">
<h3 id="org183249a"><span class="section-number-3">2.8</span> 判断和循环</h3>
<div class="outline-text-3" id="text-2-8">
<p>
Makefile使用 Bash 语法，完成判断和循环。
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #a9df90;">ifeq</span> ($(CC),gcc)
  <span style="color: #aaca86;">libs</span>=$(libs_for_gcc)
<span style="color: #91a0b3;">else</span>
  <span style="color: #aaca86;">libs</span>=$(normal_libs)
endif
</pre>
</div>
<p>
上面代码判断当前编译器是否 gcc ，然后指定不同的库文件。
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #aaca86;">LIST</span> = one two three
all:
    <span style="color: #91a0b3;">for</span> i<span style="color: #91a0b3;"> in</span> $(LIST); <span style="color: #91a0b3;">do</span> <span style="color: #ddbc91;">\</span>
        <span style="color: #9fbfdf;">echo</span> $<span style="color: #aaca86;">$i</span>; <span style="color: #ddbc91;">\</span>
    <span style="color: #91a0b3;">done</span>
<span style="color: #706565;"># </span><span style="color: #857575;">&#31561;&#21516;&#20110;</span>
all:
    <span style="color: #91a0b3;">for</span> i<span style="color: #91a0b3;"> in</span> one two three; <span style="color: #91a0b3;">do</span> <span style="color: #ddbc91;">\</span>
        <span style="color: #9fbfdf;">echo</span> $<span style="color: #aaca86;">i</span>; <span style="color: #ddbc91;">\</span>
    <span style="color: #91a0b3;">done</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcdb3910" class="outline-3">
<h3 id="orgcdb3910"><span class="section-number-3">2.9</span> 函数</h3>
<div class="outline-text-3" id="text-2-9">
<p>
Makefile还可以使用函数，格式如下。
</p>
<div class="org-src-container">
<pre class="src src-shell">$(<span style="color: #91a0b3;">function</span> <span style="color: #a9df90;">arguments</span>)
<span style="color: #706565;"># </span><span style="color: #857575;">&#25110;&#32773;</span>
${<span style="color: #91a0b3;">function</span> <span style="color: #a9df90;">arguments</span>}
</pre>
</div>
<p>
Makefile提供了许多<a href="https://www.gnu.org/software/make/manual/html_node/Functions.html">内置函数</a>，可供调用。下面是几个常用的内置函数。
</p>
<dl class="org-dl">
<dt>shell 函数</dt><dd>shell 函数用来执行 shell 命令</dd>
</dl>
<div class="org-src-container">
<pre class="src src-shell">srcfiles := $(shell echo src/{00..99}.txt)
</pre>
</div>
<dl class="org-dl">
<dt>wildcard函数</dt><dd>wildcard 函数用来在 Makefile 中，替换 Bash 的通配符。</dd>
</dl>
<div class="org-src-container">
<pre class="src src-shell">srcfiles := $(wildcard src/*.txt)
</pre>
</div>
<dl class="org-dl">
<dt>subst 函数</dt><dd>subst 函数用来文本替换，格式如下。</dd>
</dl>
<div class="org-src-container">
<pre class="src src-shell">$(subst from,to,text)
</pre>
</div>
<p>
下面的例子将字符串"feet on the street"替换成"fEEt on the strEEt"。
</p>
<div class="org-src-container">
<pre class="src src-shell">$(subst ee,EE,feet on the street)
</pre>
</div>
<p>
下面是一个稍微复杂的例子。
</p>
<div class="org-src-container">
<pre class="src src-shell">comma:= ,
empty:=
<span style="color: #706565;"># </span><span style="color: #857575;">space&#21464;&#37327;&#29992;&#20004;&#20010;&#31354;&#21464;&#37327;&#20316;&#20026;&#26631;&#35782;&#31526;&#65292;&#24403;&#20013;&#26159;&#19968;&#20010;&#31354;&#26684;</span>
space:= $(empty) $(empty)
foo:= a b c
bar:= $(subst $(space),$(comma),$(foo))
<span style="color: #706565;"># </span><span style="color: #857575;">bar is now `a,b,c'.</span>
</pre>
</div>
<dl class="org-dl">
<dt>替换后缀名</dt><dd>替换后缀名函数的写法是：变量名 + 冒号 + 后缀名替换规则。它实际上patsubst函数的一种简写形式。</dd>
</dl>
<div class="org-src-container">
<pre class="src src-shell">min: $(OUTPUT:.js=.min.js)
</pre>
</div>
<p>
上面代码的意思是，将变量OUTPUT中的后缀名 .js 全部替换成 .min.js 。
</p>
</div>
</div>
</div>
<div id="outline-container-org3e6646c" class="outline-2">
<h2 id="org3e6646c"><span class="section-number-2">3</span> Makefile的实例</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>执行多个目标</li>
</ul>
<div class="org-src-container">
<pre class="src src-shell">.PHONY: cleanall cleanobj cleandiff

cleanall : cleanobj cleandiff
        rm program

cleanobj :
        rm *.o

cleandiff :
        rm *.diff
</pre>
</div>
<p>
上面代码可以调用不同目标，删除不同后缀名的文件，也可以调用一个目标（cleanall），删除所有指定类型的文件。
</p>
<ul class="org-ul">
<li>编译C语言项目</li>
</ul>
<div class="org-src-container">
<pre class="src src-shell">edit : main.o kbd.o command.o display.o
    cc -o edit main.o kbd.o command.o display.o
main.o : main.c defs.h
    cc -c main.c
kbd.o : kbd.c defs.h command.h
    cc -c kbd.c
command.o : command.c defs.h command.h
    cc -c command.c
display.o : display.c defs.h
    cc -c display.c
clean :
     rm edit main.o kbd.o command.o display.o
.PHONY: edit clean
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2019-11-14 Thu 00:00</p>
<p class="author">Author: 方潇</p>
<p class="date">Created: 2019-11-20 Wed 20:10</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>